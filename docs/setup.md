# Setup Guide

## Prerequisites

### Required Software

- **PHP 8.3** or higher
- **Composer** 2.0 or higher
- **Node.js** 20.x or higher
- **npm** 10.x or higher (comes with Node.js)

### Database Options

- **SQLite** (recommended for development) - No installation required
- **PostgreSQL** 14+ (for production-like environment)

### Optional Tools

- **Git** for version control
- **Laravel Herd** (macOS) for local development server
- **Docker** and **Docker Compose** (alternative setup)

## Installation Steps

### 1. Clone the Repository

```bash
git clone https://github.com/yourusername/clinicflow.git
cd clinicflow
```

### 2. Install PHP Dependencies

```bash
composer install
```

This installs all PHP packages defined in `composer.json`, including Laravel framework, Inertia.js server-side adapter, and other dependencies.

### 3. Install Node.js Dependencies

```bash
npm install
```

This installs all frontend dependencies including React, Inertia.js client, Tailwind CSS, and build tools.

### 4. Environment Configuration

Copy the example environment file:

```bash
cp .env.example .env
```

Generate application encryption key:

```bash
php artisan key:generate
```

### 5. Configure Environment Variables

Edit `.env` file with your configuration:

**Database Configuration (SQLite - Default)**
```env
DB_CONNECTION=sqlite
DB_DATABASE=/absolute/path/to/database/database.sqlite
```

**Database Configuration (PostgreSQL)**
```env
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=clinicflow
DB_USERNAME=your_username
DB_PASSWORD=your_password
```

**Application Configuration**
```env
APP_NAME=ClinicFlow
APP_ENV=local
APP_KEY=(generated by key:generate)
APP_DEBUG=true
APP_URL=http://localhost:8000
```

**Mail Configuration (Optional)**
```env
MAIL_MAILER=smtp
MAIL_HOST=mailpit
MAIL_PORT=1025
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null
MAIL_FROM_ADDRESS="hello@example.com"
MAIL_FROM_NAME="${APP_NAME}"
```

**Queue Configuration (Optional)**
```env
QUEUE_CONNECTION=database
```

**SentinelStack Integration (Optional)**
```env
SENTINELSTACK_ENABLED=false
SENTINELSTACK_API_URL=
SENTINELSTACK_API_KEY=
SENTINELSTACK_SERVICE_ID=clinicflow
```

### 6. Database Setup

**For SQLite:**
```bash
touch database/database.sqlite
```

**For PostgreSQL:**
Create the database:
```sql
CREATE DATABASE clinicflow;
```

Run migrations:
```bash
php artisan migrate
```

This creates all necessary database tables:
- `users` - System users
- `password_reset_tokens` - Password reset tokens
- `sessions` - User sessions
- `cache` - Application cache
- `jobs` - Queue jobs
- Additional tables as they are added

### 7. Build Frontend Assets

**Development:**
```bash
npm run dev
```

This starts Vite dev server with hot module replacement (HMR).

**Production:**
```bash
npm run build
```

This compiles and minifies assets for production.

### 8. Start the Development Server

**Using Laravel Herd (macOS):**
If using Laravel Herd, the site is automatically available at `http://clinicflow.test`. No additional server setup needed.

**Using PHP Built-in Server:**
```bash
php artisan serve
```

The application will be available at `http://localhost:8000`.

**Using Composer Dev Script (Recommended):**
```bash
composer run dev
```

This starts:
- Laravel development server
- Queue worker
- Laravel Pail (log viewer)
- Vite dev server

All services run concurrently with color-coded output.

## Running Tests

### Run All Tests

```bash
php artisan test
```

### Run Specific Test File

```bash
php artisan test tests/Feature/ExampleTest.php
```

### Run Tests with Filter

```bash
php artisan test --filter=testName
```

### Run Tests with Coverage

```bash
php artisan test --coverage
```

### Browser (E2E) Tests

ClinicFlow uses Pest v4 browser testing with Playwright for end-to-end testing.

**First-time setup:**

Install Playwright browsers:
```bash
npx playwright install --with-deps chromium
```

**Run browser tests:**

```bash
php artisan test tests/Browser/
```

**Run specific browser test:**

```bash
php artisan test tests/Browser/Auth/LoginTest.php
```

**Run browser tests in headed mode (for debugging):**

```bash
php artisan test tests/Browser/ --headed
```

## Development Workflow

### Code Style

Format PHP code with Laravel Pint:
```bash
vendor/bin/pint
```

Format only changed files:
```bash
vendor/bin/pint --dirty
```

Format JavaScript/TypeScript code:
```bash
npm run format
```

Check code style without formatting:
```bash
npm run format:check
```

### Linting

Lint JavaScript/TypeScript code:
```bash
npm run lint
```

### Type Checking

Check TypeScript types:
```bash
npm run types
```

### Database Migrations

Create a new migration:
```bash
php artisan make:migration create_table_name
```

Run pending migrations:
```bash
php artisan migrate
```

Rollback last migration batch:
```bash
php artisan migrate:rollback
```

Reset database (drops all tables and re-runs migrations):
```bash
php artisan migrate:fresh
```

### Database Seeding

Run database seeders:
```bash
php artisan db:seed
```

Seed specific seeder:
```bash
php artisan db:seed --class=DatabaseSeeder
```

Refresh migrations and seed:
```bash
php artisan migrate:fresh --seed
```

### Queue Jobs

Start queue worker:
```bash
php artisan queue:work
```

Process single job:
```bash
php artisan queue:work --once
```

Monitor failed jobs:
```bash
php artisan queue:failed
```

Retry failed job:
```bash
php artisan queue:retry {job-id}
```

## Troubleshooting

### Permission Issues

**Storage Directory:**
```bash
chmod -R 775 storage
chmod -R 775 bootstrap/cache
```

**On Linux/macOS:**
```bash
sudo chown -R $USER:www-data storage
sudo chown -R $USER:www-data bootstrap/cache
```

### Cache Issues

Clear application cache:
```bash
php artisan cache:clear
php artisan config:clear
php artisan route:clear
php artisan view:clear
```

Optimize for production:
```bash
php artisan config:cache
php artisan route:cache
php artisan view:cache
```

### Database Connection Issues

**SQLite:**
- Ensure `database/database.sqlite` file exists
- Check file permissions (read/write)
- Verify absolute path in `.env` if using custom location

**PostgreSQL:**
- Verify PostgreSQL service is running
- Check connection credentials in `.env`
- Test connection: `psql -h 127.0.0.1 -U your_username -d clinicflow`

### Frontend Build Issues

Clear node modules and reinstall:
```bash
rm -rf node_modules package-lock.json
npm install
```

Clear Vite cache:
```bash
rm -rf node_modules/.vite
```

### Port Already in Use

If port 8000 is already in use:
```bash
php artisan serve --port=8001
```

Or specify in `.env`:
```env
APP_URL=http://localhost:8001
```

### Missing Environment Variables

Ensure `.env` file exists and contains required variables:
```bash
cp .env.example .env
php artisan key:generate
```

## Production Deployment

### Pre-Deployment Checklist

1. Set `APP_ENV=production` and `APP_DEBUG=false`
2. Generate application key: `php artisan key:generate`
3. Run migrations: `php artisan migrate --force`
4. Cache configuration: `php artisan config:cache`
5. Cache routes: `php artisan route:cache`
6. Cache views: `php artisan view:cache`
7. Build frontend assets: `npm run build`
8. Set up queue worker (supervisor or systemd)
9. Configure web server (Nginx/Apache)
10. Set up SSL certificate (HTTPS)
11. Configure database backups
12. Set up log rotation
13. Configure monitoring and alerts

### Environment Variables for Production

```env
APP_ENV=production
APP_DEBUG=false
APP_URL=https://your-domain.com

DB_CONNECTION=pgsql
DB_HOST=your_db_host
DB_DATABASE=clinicflow
DB_USERNAME=your_db_user
DB_PASSWORD=secure_password

QUEUE_CONNECTION=redis
CACHE_DRIVER=redis
SESSION_DRIVER=redis

SENTINELSTACK_ENABLED=true
SENTINELSTACK_API_URL=https://api.sentinelstack.com
SENTINELSTACK_API_KEY=your_production_api_key
```

### Web Server Configuration

**Nginx Example:**
```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /path/to/clinicflow/public;

    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-Content-Type-Options "nosniff";

    index index.php;

    charset utf-8;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    error_page 404 /index.php;

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.3-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}
```

**Apache Example:**
```apache
<VirtualHost *:80>
    ServerName your-domain.com
    DocumentRoot /path/to/clinicflow/public

    <Directory /path/to/clinicflow/public>
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
```

## Docker Setup (Alternative)

If you prefer Docker:

```bash
docker-compose up -d
```

This starts:
- PHP 8.3 with Laravel
- PostgreSQL database
- Redis for cache/queues
- Nginx web server

See `docker-compose.yml` for configuration details.

## Additional Resources

- [Laravel Documentation](https://laravel.com/docs)
- [Inertia.js Documentation](https://inertiajs.com)
- [React Documentation](https://react.dev)
- [Tailwind CSS Documentation](https://tailwindcss.com)
- [Pest PHP Documentation](https://pestphp.com)

